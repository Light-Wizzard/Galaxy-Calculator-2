#
# Galaxy Calculator 2 appveyor configuration files
# https://ci.appveyor.com/tools/validate-yaml
#https://www.appveyor.com/docs/build-environment/#qt
# https://download.qt.io/snapshots/ifw/installer-framework/30/
#
version: '{branch}-{build}'

branches:
  only:
    - master

stack: python 3.9, python 3.8

build: off

configuration: Release

platform:
  - x64
  - x86

image:
  - Ubuntu2004
  - Visual Studio 2019

for:
-
  matrix:
    only:
      - image: Ubuntu
  environment:
    MY_OS: Ubuntu # Ensure it is the same as Image
    RUNTIME_LINKAGE: static
    COVERITY_BUILD_CANDIDATE: True
    QT5_32:         $HOME/Qt/5.15.2/gcc_32/bin
    QT5_LIB_32:     ${HOME}/Qt/5.15.2/gcc_32/lib
    QT5_INCLUDE_32: ${HOME}/Qt/5.15.2/gcc_32/include
    QT5_64:         $HOME/Qt/5.15.2/gcc_64/bin
    QT5_LIB_64:     ${HOME}/Qt/5.15.2/gcc_64/lib
    QT5_INCLUDE_64: ${HOME}/Qt/5.15.2/gcc_64/include
    PY_DIR_32:      $HOME/venv3.9
    PY_DIR_64:      $HOME/venv3.9
    PY_VER: 3.9
    QT_IF_VERSION: '3.1.1'
    PRJLIBS: VCRUNTIME140.dll MSVCP140.dll
    BIN_PRO_RES_NAME: GalaxyCalculator2
    QIF_PACKAGE_URI: 'packages/com.lightwizzard.galaxycalculator2/data'
  install:
    # Create our AppVeyor version
    - ps: $env:REPO_NAME =  $env:APPVEYOR_REPO_NAME.Substring($env:APPVEYOR_REPO_NAME.IndexOf('/') + 1)
    - ps: $env:package_version = ("$(git describe --tags --always --long)").trim()
    - ps: Update-AppveyorBuild -Version "$env:package_version-$env:APPVEYOR_BUILD_NUMBER"
    - sh: bash -c "scripts/install.sh"
  build_script:
    - sh: bash -c "scripts/build-script.sh"
  artifacts:
    - path: '*.zip'
      name: 'ZipInstaller'

-
  matrix:
    only:
      - image: Visual Studio 2019
  environment:
    MY_OS: Windows # No Spaces
    RUNTIME_LINKAGE: static
    COVERITY_BUILD_CANDIDATE: True
    QT_VERSION: 5.15
    QT5_32:    C:\Qt\5.15.2\mingw81_32
    MINGW_32:  C:\Qt\Tools\mingw810_32
    QT5_64:    C:\Qt\5.15.2\mingw81_64
    MINGW_64:  C:\Qt\Tools\mingw810_64
    PY_DIR_32: C:\Python38
    PY_DIR_64: C:\Python38-x64
    PY_VER: 3.8
    QT_IF_VERSION: '3.1.1'
    PRJLIBS: VCRUNTIME140.dll MSVCP140.dll
    BIN_PRO_RES_NAME: GalaxyCalculator2
    QIF_PACKAGE_URI: 'packages\com.lightwizzard.galaxycalculator2\data'
  install:
    # Create our AppVeyor version
    - ps: $env:REPO_NAME =  $env:APPVEYOR_REPO_NAME.Substring($env:APPVEYOR_REPO_NAME.IndexOf('/') + 1)
    - ps: $env:package_version = ("$(git describe --tags --always --long)").trim()
    - ps: Update-AppveyorBuild -Version "$env:package_version-$env:APPVEYOR_BUILD_NUMBER"
    - cmd: scripts\install.cmd
  build_script:
    - cmd: scripts\build-script.cmd
  artifacts:
    - path: '%BIN%*.zip'
      name: 'ZipInstaller'

deploy:
  - provider: GitHub
    release: continuous
    artifact: 'ZipInstaller'
    draft: false
    prerelease: true
    auth_token:
      secure: 5Kb03ANp7s6KeJKren+ROsEnuCk2tXGby36aqYpG0WV8xfHBg26Td9B4C9jpI/O/
############################################## End of File ####################
